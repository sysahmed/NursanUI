# Инструкции за настройка на API Key

## Проблем: "API Key не е предоставен"

Ако виждате това съобщение, означава че приложението ElTestvApi не намира API Key в XML конфигурацията.

## Стъпка по стъпка решение:

### 1. Генерирай API Key през MVC интерфейса

1. Стартирай API-то
2. Отиди на: `http://localhost:5226/Home/Login`
3. Влез с потребител от Ambar базата данни (AspNetUsers таблица)
4. След успешен login, отиди на: `http://localhost:5226/ApiKeyManagement/Create`
5. Попълни формата:
   - **Device ID**: Уникален идентификатор на станцията (напр: `COMPUTER-001`, `STATION-A`, или използвай името на компютъра)
   - **Име на станция**: Описание (опционално, напр: "Production PC 1")
   - **Описание**: Допълнителни бележки (опционално)
6. Натисни "Създай API Key"
7. **ВАЖНО**: Запиши API Key-а който се показва! (той се показва само веднъж)

### 2. Добави API Key в Baglanti.xml файл

1. Отвори `Baglanti.xml` файла в папката на ElTestvApi приложението
2. Добави следният код в `<config>` елемента:

```xml
<apiKey Value="ВАШИЯ-API-KEY-ТУК" DeviceId="ВАШИЯ-DEVICE-ID-ТУК" />
```

**Пример:**
```xml
<?xml version="1.0" encoding="utf-8"?>
<config PLS="COM1" print="COM4" PrinterNormal="COM5" PrinterQR="COM5"  print1="1" print2="7" toplamRakkam="50" Hata="0" sicil="*397*391" tarih="" id="0">
   <server Server="10.168.0.5">
   </server>
   <apiKey Value="AbCdEf123456..." DeviceId="COMPUTER-001" />
   <!-- останалите елементи -->
</config>
```

### 3. Рестартирай ElTestvApi приложението

1. Затвори приложението
2. Стартирай го отново
3. Приложението автоматично ще провери API Key при стартиране

### 4. Проверка

Ако API Key е правилен:
- ✅ Приложението ще стартира нормално
- ✅ В конзолата ще видиш: "✅ ElTestvApi: API Key е валидиран успешно"

Ако API Key не е правилен:
- ❌ Приложението ще се блокира и ще покаже съобщение
- ❌ В конзолата ще видиш: "❌ ElTestvApi: API Key не е валиден"

## Бележки:

- API Key се записва автоматично в базата данни при генериране
- API Key работи постоянно след генериране (не се изтича)
- Може да деактивираш или регенерираш API Key от MVC интерфейса
- DeviceId трябва да е уникален за всяка станция

## Помощ:

Ако имаш проблеми:
1. Провери дали API Key е правилно записан в XML файла
2. Провери дали DeviceId в XML съвпада с DeviceId в базата данни
3. Провери дали API Key е активен в MVC интерфейса

